@using global::SwiftGrid.Entities
@typeparam TItem

@* 
    SwiftGridColumn 컴포넌트
    
    SwiftGrid 내부에서 사용하는 컬럼 정의 컴포넌트입니다.
    각 컬럼의 속성(필드명, 제목, 정렬, 필터, 편집 등)을 정의합니다.
    
    사용 예시:
    <SwiftGrid Data="@people">
        <SwiftGridColumn Field="Name" Title="이름" Sortable="true" HeaderFilter="true" />
        <SwiftGridColumn Field="Age" Title="나이" Sortable="true" Editable="true" Editor="number" />
        <SwiftGridColumn Field="Email" Title="이메일" HeaderFilter="true" />
    </SwiftGrid>
*@

@code {
    #region Parameters

    /// <summary>
    /// 부모 SwiftGrid 컴포넌트 참조 (Cascading Parameter)
    /// SwiftGridColumn은 반드시 SwiftGrid 컴포넌트 내부에서 사용해야 합니다.
    /// 이 속성은 자동으로 설정되며, 직접 설정할 필요가 없습니다.
    /// </summary>
    [CascadingParameter]
    public SwiftGrid<TItem> Owner { get; set; } = default!;

    /// <summary>
    /// 컬럼에 바인딩할 데이터 필드명 (필수)
    /// 
    /// 데이터 모델의 속성명과 일치해야 합니다.
    /// 예: Person 클래스에 Name 속성이 있다면 Field="Name"
    /// 
    /// PascalCase 또는 camelCase 모두 사용 가능합니다.
    /// </summary>
    [Parameter]
    [EditorRequired]
    public string Field { get; set; } = default!;

    /// <summary>
    /// 컬럼 헤더에 표시할 제목 (필수)
    /// 
    /// 사용자에게 보여질 컬럼 이름입니다.
    /// 예: "이름", "나이", "이메일" 등
    /// </summary>
    [Parameter]
    [EditorRequired]
    public string Title { get; set; } = default!;

    /// <summary>
    /// 정렬 가능 여부
    /// 
    /// true: 컬럼 헤더를 클릭하면 해당 컬럼으로 정렬됩니다.
    /// false: 정렬 불가 (기본값)
    /// 
    /// 예: Sortable="true"
    /// </summary>
    [Parameter]
    public bool Sortable { get; set; } = false;

    /// <summary>
    /// 컬럼 표시 여부
    /// 
    /// true: 컬럼이 표시됨 (기본값)
    /// false: 컬럼이 숨겨짐 (데이터는 있지만 화면에 표시되지 않음)
    /// </summary>
    [Parameter]
    public bool Visible { get; set; } = true;

    /// <summary>
    /// 데이터 포맷터 (Tabulator 포맷터 이름)
    /// 
    /// 셀의 데이터를 표시할 때 사용할 포맷터를 지정합니다.
    /// 예: "money", "datetime", "tickCross" 등
    /// 
    /// null이면 기본 포맷터를 사용합니다.
    /// </summary>
    [Parameter]
    public string? Formatter { get; set; }

    /// <summary>
    /// 컬럼 너비 (픽셀 단위)
    /// 
    /// 예: Width="150" (150픽셀 너비)
    /// null이면 자동으로 너비가 조정됩니다.
    /// </summary>
    [Parameter]
    public int? Width { get; set; }

    /// <summary>
    /// 헤더 필터 활성화 여부
    /// 
    /// true: 헤더에 필터 입력 필드가 표시됩니다 (기본 input 타입)
    /// "input": 텍스트 입력 필터
    /// "number": 숫자 입력 필터
    /// "select": 드롭다운 선택 필터
    /// false 또는 null: 필터 비활성화 (기본값)
    /// 
    /// 예시:
    /// HeaderFilter="true"  // 기본 텍스트 필터
    /// HeaderFilter="number" // 숫자 필터
    /// HeaderFilter="select" // 선택 필터 (HeaderFilterParams 필요)
    /// </summary>
    [Parameter]
    public object? HeaderFilter { get; set; } = null;

    /// <summary>
    /// 헤더 필터 placeholder 텍스트
    /// 
    /// 필터 입력 필드에 표시될 힌트 텍스트입니다.
    /// 예: HeaderFilterPlaceholder="이름 검색..."
    /// </summary>
    [Parameter]
    public string? HeaderFilterPlaceholder { get; set; } = null;

    /// <summary>
    /// 헤더 필터 파라미터
    /// 
    /// select 타입 필터를 사용할 때 선택 옵션을 지정합니다.
    /// 
    /// 예시:
    /// HeaderFilterParams="@(new { values = new[] { "개발팀", "인사팀", "마케팅팀" } })"
    /// </summary>
    [Parameter]
    public object? HeaderFilterParams { get; set; } = null;

    /// <summary>
    /// 셀 편집 가능 여부
    /// 
    /// true: 셀을 클릭하거나 더블클릭하여 편집할 수 있습니다.
    /// false: 편집 불가
    /// null: SwiftGridOptions의 기본값 사용
    /// 
    /// 편집 기능을 사용하려면 Editor 속성도 함께 설정해야 합니다.
    /// </summary>
    [Parameter]
    public bool? Editable { get; set; } = null;

    /// <summary>
    /// 셀 편집기 타입
    /// 
    /// 편집할 때 사용할 입력 컨트롤의 타입을 지정합니다.
    /// 
    /// 가능한 값:
    /// - "input": 텍스트 입력 (기본값)
    /// - "textarea": 여러 줄 텍스트 입력
    /// - "number": 숫자 입력
    /// - "select": 드롭다운 선택
    /// - "date": 날짜 선택
    /// 
    /// 예: Editor="number" (숫자 입력 편집기)
    /// </summary>
    [Parameter]
    public string? Editor { get; set; } = null;

    /// <summary>
    /// 셀 편집기 파라미터
    /// 
    /// select 타입 편집기를 사용할 때 선택 옵션을 지정합니다.
    /// 
    /// 예시:
    /// EditorParams="@(new { values = new[] { "개발팀", "인사팀", "마케팅팀" } })"
    /// </summary>
    [Parameter]
    public object? EditorParams { get; set; } = null;

    #endregion

    #region Lifecycle Methods

    /// <summary>
    /// 컴포넌트 초기화 시 컬럼 정의를 부모 그리드에 등록합니다.
    /// 
    /// 이 메서드는 자동으로 호출되며, 컬럼 정보를 SwiftGrid에 전달합니다.
    /// </summary>
    /// <exception cref="InvalidOperationException">
    /// SwiftGridColumn이 SwiftGrid 컴포넌트 외부에서 사용된 경우
    /// </exception>
    protected override void OnInitialized()
    {
        // 부모 SwiftGrid 컴포넌트가 없으면 오류 발생
        if (Owner == null)
        {
            throw new InvalidOperationException(
                $"{nameof(SwiftGridColumn<TItem>)} must be used inside a {nameof(SwiftGrid<TItem>)}. " +
                $"Wrap the column definitions in a {nameof(SwiftGrid<TItem>)} component."
            );
        }

        // 컬럼 정의 객체 생성
        var columnDefinition = new SwiftGridColumnDefinition
        {
            Field = Field,
            Title = Title,
            Sortable = Sortable,
            Visible = Visible,
            Formatter = Formatter,
            Width = Width,
            HeaderFilter = HeaderFilter,
            HeaderFilterPlaceholder = HeaderFilterPlaceholder,
            HeaderFilterParams = HeaderFilterParams,
            Editable = Editable,
            Editor = Editor,
            EditorParams = EditorParams
        };

        // 부모 그리드에 컬럼 등록
        Owner.RegisterColumn(columnDefinition);
    }

    #endregion
}